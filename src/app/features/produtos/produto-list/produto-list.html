<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Produtos</h2>
  @if (authService.isAdmin()) {
    <a routerLink="/produtos/novo" class="btn btn-primary">Novo Produto</a>
  }
</div>

@if (loading) {
  <app-loading-spinner />
} @else {
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th style="width: 80px">Imagem</th>
          <th>Descrição</th>
          <th>Valor de Venda</th>
          <th>Estoque</th>
          @if (authService.isAdmin()) {
            <th style="width: 150px">Ações</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (produto of produtos; track produto.id) {
          <tr>
            <td>
              @if (produto.imagens && produto.imagens.length > 0) {
                <img
                  [src]="getImageUrl(produto.imagens[0].path)"
                  alt="Produto"
                  class="img-thumbnail"
                  style="width: 60px; height: 60px; object-fit: cover;"
                />
              } @else {
                <span class="text-muted">-</span>
              }
            </td>
            <td>{{ produto.descricao }}</td>
            <td>{{ produto.valorVenda | currency: 'BRL' }}</td>
            <td>{{ produto.estoque }}</td>
            @if (authService.isAdmin()) {
              <td>
                <a
                  [routerLink]="['/produtos', produto.id, 'editar']"
                  class="btn btn-sm btn-warning me-1"
                >
                  Editar
                </a>
                <button class="btn btn-sm btn-danger" (click)="onDelete(produto)">
                  Excluir
                </button>
              </td>
            }
          </tr>
        } @empty {
          <tr>
            <td [attr.colspan]="authService.isAdmin() ? 5 : 4" class="text-center">
              Nenhum produto encontrado.
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (meta.totalPages > 1) {
    <div class="d-flex justify-content-center">
      <ngb-pagination
        [collectionSize]="meta.total"
        [page]="meta.page"
        [pageSize]="meta.limit"
        (pageChange)="onPageChange($event)"
      />
    </div>
  }
}
